<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/common/layout :: layout(~{::title},~{::body/content()})}">
<head>
<meta charset="UTF-8" />
<title>ユーザー詳細</title>
</head>
<body>

	<h2>ユーザー詳細</h2>

	<h3>基本情報</h3>
	<table class="table table-hover" th:object="${lmsUserDto.userDetailDto}">
		<tr>
			<th class="w33per">ユーザー名</th>
			<td>[[*{userName}]]</td>
		</tr>
		<tr th:if="*{role == '0001' || role == '0003' || role == '0005'}">
			<th>企業名</th>
			<td>[[*{companyName}]]</td>
		</tr>
		<tr th:if="*{role == '0001'}">
			<th>コース</th>
			<td>[[*{courseName}]]</td>
		</tr>
		<tr th:if="*{role == '0001' || role == '0002'}">
			<th>会場</th>
			<td>
				<span>[[*{placeName}]]</span>
				<span th:if="*{placeNote != null }">[[*{placeNote}]]</span>
				<br /> <span>[[*{placeDescription}]]</span>
			</td>
		</tr>
		<tr th:if="*{role == '0001'}">
			<th>研修を通じてどのようになってほしいか</th>
			<td>
				<span th:if="*{hopeViaTraning != null}">[[*{hopeViaTraning}]]</span> 
				<span th:unless="*{hopeViaTraning != null }" class="text-danger">※登録されていません</span>
			</td>
		</tr>
		<tr th:if="*{role == '0001'}">
			<th>プログラミング経験</th>
			<td th:switch="*{programmingExperience}">
				<span th:case="0">なし</span>
				<span th:case="1">あり</span>
				<span th:case="*" class="text-danger">※登録されていません</span>
			</td>
		</tr>
	</table>

	<form th:if="${session.loginUserDto.role == '0001'}" th:action="@{/password/changePassword}" th:method="post">
		<input type="submit" class="btn btn-default" value="パスワード変更する" />
	</form>
	<!-- Task.45 -->
	<form th:if="${session.loginUserDto.role == '0004'}" th:action="@{/password/reissuePassword}" th:method="post">
		<input type="hidden" name="userId" th:value="${lmsUserDto.userDetailDto.userId}" /> 
		<input type="submit" class="btn btn-default" value="パスワード再発行" onclick="return submitcheck()" />
	</form>

	<!-- Task.46 -->
	<div class="mt20" th:if="${(session.loginUserDto.role == '0002' || session.loginUserDto.role == '0004') && lmsUserDto.userDetailDto.role == '0001'}">
		<h3 class="ib">面談記録</h3>
		<form method="get" th:action="@{/meeting/regist}" class="ml30 mb10 ib">
			<input type="submit" value="登録する" class="btn btn-primary" />
			<input type="hidden" name="lmsUserId" th:value="${lmsUserDto.userDetailDto.lmsUserId}" />
		</form>
		<table class="table table-hover">
			<tr>
				<th class="w33per">面談日</th>
				<th>編集</th>
			</tr>
			<tr th:each="meetingDto : ${lmsUserDto.meetingDtoList}" th:object="${meetingDto}">
				<td>[[*{#dates.format(firstCreateDate, "yyyy年M月d日(E)")}]]</td>
				<td>
					<form method="get" th:action="@{/meeting/regist}">
						<input type="submit" value="修正する" class="btn btn-default" />
						<input type="hidden" name="lmsUserId" th:value="${lmsUserDto.userDetailDto.lmsUserId}" />
						<input type="hidden" name="meetingId" th:value="*{meetingId}" />
					</form>
					<form method="post" th:action="@{/meeting/delete}" onsubmit="return delcheck()">
						<input type="submit" value="削除する" class="btn btn-default" />
						<input type="hidden" name="lmsUserId" th:value="${lmsUserDto.userDetailDto.lmsUserId}" />
						<input type="hidden" name="meetingId" th:value="*{meetingId}" />
					</form>
					<form th:if="*{meetingFileDeleteFlg == 0}" th:action="@{/meeting/download}" method="post">
						<input type="submit" value="ダウンロード" class="btn btn-default" />
						<input type="hidden" name="meetingId" th:value="*{meetingId}" />
					</form>
				</td>
			</tr>
		</table>
	</div>

	<th:block th:if="!${#lists.isEmpty(lmsUserDto.examResultDtoList)}">
		<h3>試験</h3>
		<table class="table table-hover">
			<tr>
				<th class="w33per">試験名</th>
				<th>日付</th>
				<th>点数</th>
				<th>詳細</th>
			</tr>
			<tr th:each="examResultDto : ${lmsUserDto.examResultDtoList}" th:object="${examResultDto}">
				<td>[[*{examName}]]</td>
				<td>[[*{#dates.format(date, "yyyy年M月d日(E)")}]]</td>
				<td>[[*{#numbers.formatDecimal(point, 1, 1)}]]点</td>
				<td>
					<form th:action="@{/exam/detail}" th:method="post">
						<input type="submit" class="btn btn-default" value="詳細" />
						<input type="hidden" th:name="examSectionId" th:value="*{examSectionId}" />
						<input type="hidden" th:name="lmsUserId" th:value="${lmsUserDto.userDetailDto.lmsUserId}" />
					</form>
				</td>
			</tr>
		</table>
	</th:block>

	<th:block th:if="!${#lists.isEmpty(lmsUserDto.dailyReportDtoList)}">
		<h3>レポート</h3>
		<table class="table table-hover">
			<tr>
				<th>日付</th>
				<th>レポート名</th>
				<th>コメント</th>
				<th>最新コメント登録日時</th>
				<th>詳細</th>
			</tr>
			<tr th:each="dailyReportDto : ${lmsUserDto.dailyReportDtoList}" th:object="${dailyReportDto}">
				<!--Task.21 ①試験の日付の表示変更 -->
				<td>[[*{#dates.format(date, "yyyy年M月d日(E)")}]]</td>
				<td>[[*{reportName}]]</td>
				<!--Task.21 ③最新コメントのnew表示 -->
				<td>[[*{fbCount}]]件 <small th:if="*{fbNewFlg}" class="fc_red b">new</small></td>
				<!--Task.21 ②最新コメント登録日時の表示変更 -->
				<td>[[*{#dates.format(lastFeedbackDate, "yyyy年M月d日(E) H時mm分")}]]</td>
				<td>
					<form th:action="@{/report/detail}" th:method="post">
						<input type="submit" class="btn btn-default" value="詳細" /> 
						<input type="hidden" th:name="dailyReportSubmitId" th:value="*{dailyReportSubmitId}" />
					</form>
					<!--Task.21 ④レポート登録画面への遷移 -->
					<form th:action="@{/report/regist}" th:method="post">
						<input type="submit" class="btn btn-default" value="修正する" /> 
						<input type="hidden" th:name="dailyReportSubmitId" th:value="*{dailyReportSubmitId}" />
					</form>
					<form th:action="@{/report/download}" th:method="post">
						<input type="submit" class="btn btn-default" th:value="ダウンロード" /> 
						<input type="hidden" th:name="dailyReportId" th:value="*{dailyReportId}" />
						<input type="hidden" th:name="dailyReportSubmitId" th:value="*{dailyReportSubmitId}" />
					</form>
				</td>
			</tr>
		</table>
	</th:block>

</body>
</html>