<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{/common/layout :: layout(~{::title},~{::body/content()})}">

<head>
	<meta charset="UTF-8">
	<title>勤怠情報変更｜LMS</title>
</head>

<body>

	<!-- 完了メッセージ -->
	<th:block th:if="${not #strings.isEmpty(message)}" id="message">
		<div class="alert alert-info alert-dismissible fade in" role="alert">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">×</span>
			</button>
			<span>[[${message}]]</span>
		</div>
	</th:block>

	<h2>勤怠管理</h2>

	<!-- エラーメッセージ -->
	<th:block th:if="${not #strings.isEmpty(error)}" id="error">
		<ul style="padding-left: 0; list-style: none;">
			<li><span th:text="'*' + '&nbsp' + ${error}" class="help-inline error"></span></li>
		</ul>
	</th:block>

	<!-- Task.72 -->
	<th:block th:if="${session.loginUserDto.role != '0001'}">
		<h3>受講生情報</h3>
		<table class="table table-hover" th:object="${lmsUserDto.userDetailDto}">
			<tr>
				<th>ユーザー名</th>
				<td>[[*{userName}]]</td>
			</tr>
			<tr>
				<th>企業名</th>
				<td>[[*{companyName}]]</td>
			</tr>
			<tr>
				<th>コース</th>
				<td>[[*{courseName}]]</td>
			</tr>
			<tr>
				<th>会場</th>
				<td>
					<span>[[*{placeName}]]</span>
					<span th:if="*{placeNote != null }">[[*{placeNote}]]</span>
					<br />
					<span>[[*{placeDescription}]]</span>
				</td>
			</tr>
		</table>

		<h3>勤怠情報</h3>
	</th:block>

	<th:block th:if="${session.loginUserDto.role == '0001'}">
		<div class="well well-lg p10 mb10">
			<div class="form-group">
				<small id="now"></small>
			</div>
			<div class="form-group">
				<form th:method="post" class="form-inline" th:action="@{/attendance/detail}">
					<!-- Task.24 ②確認ダイアログの追加 -->
					<input type="submit" name="punchIn" class="btn btn-default punch-button" value="出勤" />
					<input type="submit" name="punchOut" class="btn btn-default punch-button" value="退勤" />
				</form>
			</div>
			<p><a th:href="@{/attendance/update}">勤怠情報を直接編集する</a></p>
		</div>
	</th:block>

	<div class="row">
		<div class="bs-component col-sm-12">
			<table class="table table-hover dataTable no-footer">
				<thead class="db">
					<tr>
						<th class="w160">日付</th>
						<th class="w260">コース内容</th>
						<th class="w80">出勤</th>
						<th class="w80">退勤</th>
						<th class="w120">中抜け時間</th>
						<th class="w120">ステータス</th>
						<th class="w200">備考</th>
					</tr>
				</thead>
				<!-- Task.24 ③勤怠一覧のスクロール表示 -->
				<tbody class="db" style="overflow-y: scroll; height: 360px;">
					<th:block th:each="attendanceManagementDto : ${attendanceManagementDtoList}"
						th:object="${attendanceManagementDto}">
						<!-- Task.24 ①当日の強調表示 -->
						<tr th:classappend="*{isToday} ? info : ''">
							<td class="w160">[[*{#dates.format(trainingDate, 'yyyy年M月d日(E)')}]]</td>
							<td class="w260">[[*{sectionName}]]</td>
							<td class="w80">[[*{trainingStartTime}]]</td>
							<td class="w80">[[*{trainingEndTime}]]</td>
							<td class="w120">[[*{blankTimeValue}]]</td>
							<td class="w120">[[*{statusDispName}]]</td>
							<td class="w200">[[*{note}]]</td>
						</tr>
					</th:block>
				</tbody>
			</table>
		</div>
	</div>

	<script type="text/javascript" th:inline="javascript">
		$(function () {
			$("#now").text('現在の時刻は　' + getClock() + '　です。');
			setInterval(function () {
				$("#now").text('現在の時刻は　' + getClock() + '　です。');
			}, 1000);
		});
		function getClock() {
			const today = new Date();
			const hours = ('0' + today.getHours()).slice(-2);
			const minutes = ('0' + today.getMinutes()).slice(-2);
			return hours + ':' + minutes;
		}

		// Task.24 ②確認ダイアログの追加
		$(function () {
			$('.punch-button').click(function () {
				confirm("打刻します。よろしいですか？");
			});
		});
		// Task.25 過去日が未入力の場合の表示
		$(document).ready(function () {
			if (/*[[${notEnterFlg}]]*/notEnterFlg) {
				alert('過去日の勤怠に未入力があります。');
			}
		});
	</script>

</body>

</html>